{"ast":null,"code":"import { useRef, useState } from \"react\";\nimport axios from \"axios\";\nimport PropTypes from \"prop-types\";\nimport moment from \"moment\";\nimport * as d3 from \"d3\";\nimport sorter from \"lodash.sortby\";\nimport ResizeObserver from \"resize-observer-polyfill\";\nexport const dateFilter = (startDate, endDate, data) => {\n  const momentFormat = d => moment(d);\n\n  const dateFilteredData = startDate && endDate && data.filter(area => {\n    if (momentFormat(area.key).diff(startDate) > 0 && momentFormat(area.key).diff(endDate) < 0) {\n      return area;\n    }\n  });\n  if (dateFilteredData) return dateFilteredData;\n  return data;\n};\nexport const sortBy = (sortingKey, data) => sorter(data, d => d[sortingKey]);\nexport const formatAPIEndPoint = () => {\n  const AreaType = \"ltla\";\n  const AreaName = \"*\";\n  const filters = [`areaType=${AreaType}`];\n  const structure = {\n    date: \"date\",\n    name: \"areaName\",\n    code: \"areaCode\",\n    cases: {\n      daily: \"newCasesBySpecimenDate\",\n      cumulative: \"newCasesBySpecimenDate\"\n    }\n  };\n  const apiParams = `filters=${filters.join(\";\")}&structure=${JSON.stringify(structure)}`;\n  const encodedParams = encodeURI(apiParams);\n  const endpoint = `https://api.coronavirus.data.gov.uk/v1/data?${encodedParams}`;\n  return endpoint;\n};\nexport const areaFilter = (selectedArea, data) => {\n  const Areas = selectedArea.map(item => item.value);\n  const optedArea = data.map(area => {\n    return {\n      key: area.key,\n      values: area.values.filter(d => {\n        if (Areas.includes(d.areaName)) {\n          return d;\n        }\n      })\n    };\n  });\n  return optedArea;\n};\nexport const getPaginatedData = async (filters, structure) => {\n  const endpoint = \"https://api.coronavirus.data.gov.uk/v1/data\",\n        apiParams = {\n    filters: filters.join(\";\"),\n    structure: JSON.stringify(structure)\n  },\n        result = [];\n  let nextPage = null,\n      currentPage = 1;\n\n  do {\n    const {\n      data,\n      status,\n      statusText\n    } = await axios.get(endpoint, {\n      params: { ...apiParams,\n        page: currentPage\n      },\n      timeout: 10000\n    });\n    if (status >= 400) throw Error(statusText);\n    if (\"pagination\" in data) nextPage = data.pagination.next || null;\n    result.push(...data.data);\n    currentPage++;\n  } while (nextPage);\n\n  return result;\n};\nexport const groupDataByKey = (key, data) => {\n  const groupedData = d3.nest().key(d => d[key]).entries(data);\n  return groupedData;\n};\nexport const accessorPropsType = PropTypes.oneOfType([PropTypes.func, PropTypes.number]);\nexport const useAccessor = (accessor, d, i) => typeof accessor == \"function\" ? accessor(d, i) : accessor;\nexport const dimensionsPropsType = PropTypes.shape({\n  height: PropTypes.number,\n  width: PropTypes.number,\n  marginTop: PropTypes.number,\n  marginRight: PropTypes.number,\n  marginBottom: PropTypes.number,\n  marginLeft: PropTypes.number\n});\nexport const combineChartDimensions = dimensions => {\n  let parsedDimensions = {\n    marginTop: 40,\n    marginRight: 30,\n    marginBottom: 40,\n    marginLeft: 75,\n    ...dimensions\n  };\n  return { ...parsedDimensions,\n    boundedHeight: Math.max(parsedDimensions.height - parsedDimensions.marginTop - parsedDimensions.marginBottom, 0),\n    boundedWidth: Math.max(parsedDimensions.width - parsedDimensions.marginLeft - parsedDimensions.marginRight, 0)\n  };\n};\nexport const useChartDimensions = passedSettings => {\n  const ref = useRef();\n  const dimensions = combineChartDimensions(passedSettings);\n  const [width, changeWidth] = useState(800);\n  const [height, changeHeight] = useState(500);\n\n  if (dimensions.width && dimensions.height) {\n    return [ref, dimensions];\n  }\n\n  const newSettings = combineChartDimensions({ ...dimensions,\n    width: dimensions.width || width,\n    height: dimensions.height || height\n  });\n  return [ref, newSettings];\n};\nlet lastId = 0;\nexport const useUniqueId = (prefix = \"\") => {\n  lastId++;\n  return [prefix, lastId].join(\"-\");\n};","map":{"version":3,"sources":["/home/venkat/Desktop/covid-vis/src/Chart/utils.js"],"names":["useRef","useState","axios","PropTypes","moment","d3","sorter","ResizeObserver","dateFilter","startDate","endDate","data","momentFormat","d","dateFilteredData","filter","area","key","diff","sortBy","sortingKey","formatAPIEndPoint","AreaType","AreaName","filters","structure","date","name","code","cases","daily","cumulative","apiParams","join","JSON","stringify","encodedParams","encodeURI","endpoint","areaFilter","selectedArea","Areas","map","item","value","optedArea","values","includes","areaName","getPaginatedData","result","nextPage","currentPage","status","statusText","get","params","page","timeout","Error","pagination","next","push","groupDataByKey","groupedData","nest","entries","accessorPropsType","oneOfType","func","number","useAccessor","accessor","i","dimensionsPropsType","shape","height","width","marginTop","marginRight","marginBottom","marginLeft","combineChartDimensions","dimensions","parsedDimensions","boundedHeight","Math","max","boundedWidth","useChartDimensions","passedSettings","ref","changeWidth","changeHeight","newSettings","lastId","useUniqueId","prefix"],"mappings":"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","sourcesContent":["import { useRef, useState } from \"react\";\nimport axios from \"axios\";\nimport PropTypes from \"prop-types\";\nimport moment from \"moment\";\nimport * as d3 from \"d3\";\nimport sorter from \"lodash.sortby\";\nimport ResizeObserver from \"resize-observer-polyfill\";\n\nexport const dateFilter = (startDate, endDate, data) => {\n  const momentFormat = (d) => moment(d);\n  const dateFilteredData =\n    startDate &&\n    endDate &&\n    data.filter((area) => {\n      if (\n        momentFormat(area.key).diff(startDate) > 0 &&\n        momentFormat(area.key).diff(endDate) < 0\n      ) {\n        return area;\n      }\n    });\n  if (dateFilteredData) return dateFilteredData;\n  return data;\n};\n\nexport const sortBy = (sortingKey, data) => sorter(data, (d) => d[sortingKey]);\n\nexport const formatAPIEndPoint = () => {\n  const AreaType = \"ltla\";\n  const AreaName = \"*\";\n\n  const filters = [`areaType=${AreaType}`];\n  const structure = {\n    date: \"date\",\n    name: \"areaName\",\n    code: \"areaCode\",\n    cases: {\n      daily: \"newCasesBySpecimenDate\",\n      cumulative: \"newCasesBySpecimenDate\",\n    },\n  };\n  const apiParams = `filters=${filters.join(\";\")}&structure=${JSON.stringify(\n    structure\n  )}`;\n  const encodedParams = encodeURI(apiParams);\n  const endpoint = `https://api.coronavirus.data.gov.uk/v1/data?${encodedParams}`;\n  return endpoint;\n};\n\nexport const areaFilter = (selectedArea, data) => {\n  const Areas = selectedArea.map((item) => item.value);\n  const optedArea = data.map((area) => {\n    return {\n      key: area.key,\n      values: area.values.filter((d) => {\n        if (Areas.includes(d.areaName)) {\n          return d;\n        }\n      }),\n    };\n  });\n  return optedArea;\n};\n\nexport const getPaginatedData = async (filters, structure) => {\n  const endpoint = \"https://api.coronavirus.data.gov.uk/v1/data\",\n    apiParams = {\n      filters: filters.join(\";\"),\n      structure: JSON.stringify(structure),\n    },\n    result = [];\n\n  let nextPage = null,\n    currentPage = 1;\n\n  do {\n    const { data, status, statusText } = await axios.get(endpoint, {\n      params: {\n        ...apiParams,\n        page: currentPage,\n      },\n      timeout: 10000,\n    });\n\n    if (status >= 400) throw Error(statusText);\n\n    if (\"pagination\" in data) nextPage = data.pagination.next || null;\n\n    result.push(...data.data);\n\n    currentPage++;\n  } while (nextPage);\n\n  return result;\n};\n\nexport const groupDataByKey = (key, data) => {\n  const groupedData = d3\n    .nest()\n    .key((d) => d[key])\n    .entries(data);\n  return groupedData;\n};\n\nexport const accessorPropsType = PropTypes.oneOfType([\n  PropTypes.func,\n  PropTypes.number,\n]);\n\nexport const useAccessor = (accessor, d, i) =>\n  typeof accessor == \"function\" ? accessor(d, i) : accessor;\n\nexport const dimensionsPropsType = PropTypes.shape({\n  height: PropTypes.number,\n  width: PropTypes.number,\n  marginTop: PropTypes.number,\n  marginRight: PropTypes.number,\n  marginBottom: PropTypes.number,\n  marginLeft: PropTypes.number,\n});\n\nexport const combineChartDimensions = (dimensions) => {\n  let parsedDimensions = {\n    marginTop: 40,\n    marginRight: 30,\n    marginBottom: 40,\n    marginLeft: 75,\n    ...dimensions,\n  };\n\n  return {\n    ...parsedDimensions,\n    boundedHeight: Math.max(\n      parsedDimensions.height -\n        parsedDimensions.marginTop -\n        parsedDimensions.marginBottom,\n      0\n    ),\n    boundedWidth: Math.max(\n      parsedDimensions.width -\n        parsedDimensions.marginLeft -\n        parsedDimensions.marginRight,\n      0\n    ),\n  };\n};\n\nexport const useChartDimensions = (passedSettings) => {\n  const ref = useRef();\n  const dimensions = combineChartDimensions(passedSettings);\n\n  const [width, changeWidth] = useState(800);\n  const [height, changeHeight] = useState(500);\n\n  if (dimensions.width && dimensions.height) {\n    return [ref, dimensions];\n  }\n\n  const newSettings = combineChartDimensions({\n    ...dimensions,\n    width: dimensions.width || width,\n    height: dimensions.height || height,\n  });\n\n  return [ref, newSettings];\n};\n\nlet lastId = 0;\nexport const useUniqueId = (prefix = \"\") => {\n  lastId++;\n  return [prefix, lastId].join(\"-\");\n};\n"]},"metadata":{},"sourceType":"module"}